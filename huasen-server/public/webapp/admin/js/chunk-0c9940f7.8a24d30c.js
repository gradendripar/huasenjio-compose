(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-0c9940f7"],{"12bd":function(t,e,i){},"829d":function(t,e,i){"use strict";i("a727")},"9ff0":function(t,e,i){"use strict";var a=i("b2d8"),o=(i("64e1"),{name:"MarkdownEditor",data:()=>({toolbars:{bold:!0,italic:!0,header:!0,underline:!0,strikethrough:!0,mark:!0,superscript:!0,subscript:!0,quote:!0,table:!0,ol:!0,ul:!0,link:!0,imagelink:!0,help:!1,code:!0,subfield:!0,fullscreen:!0,readmodel:!0,undo:!0,shortCut:!1,trash:!0,autofocus:!1,save:!1,navigation:!0},prop:{subfield:!0,defaultOpen:"preview",editable:!1,toolbarsFlag:!1,scrollStyle:!0}}),props:{value:{type:String,default:""},placeholder:{type:String,default:"请输入..."},onImgAdd:{type:Function}},computed:{valueCP:{get(){return this.value},set(t){this.$emit("update:value",t)}}},components:{mavonEditor:a.mavonEditor},methods:{save(t,e){this.$emit("onSave")},change(){this.$emit("change")},async handleImgAdd(t,e){let i=await this.onImgAdd(t,e);this.$refs.mavonEditor.$img2Url(t,i)}}}),l=(i("829d"),i("2877")),n=Object(l.a)(o,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"h-markdown-editor"},[e("mavon-editor",{ref:"mavonEditor",staticClass:"markdown-editor",attrs:{placeholder:t.placeholder,toolbars:this.toolbars,scrollStyle:!0,transition:!0,editable:!0,ishljs:!0,tabSize:2},on:{save:t.save,change:t.change,imgAdd:t.handleImgAdd},model:{value:t.valueCP,callback:function(e){t.valueCP=e},expression:"valueCP"}})],1)}),[],!1,null,"2b6b6916",null);e.a=n.exports},a727:function(t,e,i){},e2ee:function(t,e,i){"use strict";i("12bd")},f6af:function(t,e,i){"use strict";i.r(e);i("14d9"),i("e9f5"),i("f665"),i("7d54"),i("ab43");var a=i("8c8a"),o=i("ca7f"),l=i("102f"),n=i("9ff0");const s=new(i("dabc").b),d=s.getElementFormValidator.bind(s);var r={name:"SiteManage",components:{HsDialog:a.a,TableList:o.a,DialogForm:l.a,MarkdownEditor:n.a},data(){return{total:0,tableData:[],tableMap:[{label:"网站名称",key:"name"},{label:"网站链接",key:"url"},{label:"网站描述",key:"description"},{label:"网站图标",key:"icon",width:100},{label:"访问量",key:"pv",width:64},{label:"权限码",key:"code"},{label:"是否可用",key:"enabled"}],searchFormMap:[{label:"名称",type:"input",key:"name",value:"",show:!0},{label:"链接",key:"url",type:"input",value:"",show:!1},{label:"描述",type:"input",key:"description",value:"",show:!1},{label:"备注",type:"input",key:"remarks",value:"",show:!1},{label:"标签",type:"input",key:"tag",value:"",show:!1},{label:"置顶标记",type:"select",key:"pin",value:void 0,typeConfig:{options:this.CONSTANT.dictionary.pin},show:!1},{label:"权限码",key:"code",type:"select",value:void 0,typeConfig:{options:this.CONSTANT.dictionary.code},show:!0},{label:"是否可用",key:"enabled",type:"select",value:void 0,typeConfig:{options:[{label:"可用",value:!0},{label:"禁用",value:!1}]},show:!1}],show:!1,showImport:!1,showDetail:!1,mode:"add",importMode:"add",formMap:[{label:"名称",key:"name",type:"input"},{label:"链接",key:"url",type:"input"},{label:"图标",key:"icon",type:"icon"},{label:"描述",key:"description",type:"input"},{label:"网站标签",key:"siteTag",type:"select",typeConfig:{options:[],"allow-create":!0,filterable:!0,multiple:!0}},{label:"置顶标记",key:"sitePin",type:"select",typeConfig:{options:this.CONSTANT.dictionary.pin,filterable:!0,multiple:!0}},{label:"所属栏目",key:"columnId",type:"select",typeConfig:{options:[],"allow-create":!0,filterable:!0,multiple:!0}},{label:"备注",key:"remarks",type:"input"},{label:"权限码",key:"code",type:"select",typeConfig:{options:this.CONSTANT.dictionary.code}},{label:"是否可用",key:"enabled",type:"switch"}],importFormMap:[{label:"所属栏目",key:"columnId",type:"select",typeConfig:{options:[],filterable:!0,multiple:!0}},{label:"操作类型",key:"siteInOut",type:"siteInOut"}],rule:{name:[{validator:d(["isNonEmpty::必填项","minLength:2::长度不能小于2","maxLength:20::长度不能大于20"])}],url:[{validator:d(["isNonEmpty::必填项","isUrl::请输入正确的网址"])}],expand:[{validator:d(["isNonEmpty::必填项","isJSONObject::请输入JSON对象"])}]},importRule:{},form:{name:"",url:"",icon:"",description:"",remarks:"",expand:"{}",enabled:!0,code:0,siteTag:[],sitePin:[],columnId:[]},importForm:{siteTag:[],columnId:[]},initForm:null,pageNo:1,pageSize:10,siteTagNameOptions:[],columnOptions:[],activeSite:{},currentSiteDetail:""}},activated(){this.queryData(),this.queryColumnData()},mounted(){},methods:{queryData(){let t=this.$refs.tableList.getFormData(),e=Object.assign({pageNo:this.pageNo,pageSize:this.pageSize},t);this.API.site.findSiteByPage(e,{notify:!1}).then(t=>{this.tableData=t.data.list,this.total=t.data.total,this.cancel()}),this.API.site.findSiteTagByList({},{notify:!1}).then(t=>{let e=this.formMap.find(t=>"siteTag"===t.key),i=this.importFormMap.find(t=>"siteTag"===t.key);this.siteTagNameOptions=t.data.map(t=>({label:t,value:t})),e&&(e.typeConfig.options=[...this.siteTagNameOptions]),i&&(i.typeConfig.options=[...this.siteTagNameOptions])})},queryColumnData(){this.API.column.findColumnByList({},{notify:!1}).then(t=>{this.columnOptions=t.data.map(t=>({label:t.name,value:t._id}));let e=this.importFormMap.find(t=>"columnId"===t.key),i=this.formMap.find(t=>"columnId"===t.key);e&&(e.typeConfig.options=[...this.columnOptions]),i&&(i.typeConfig.options=[...this.columnOptions])})},updatePagination(t,e){this.pageNo=t,this.pageSize=e},handleSiteImportSuccess(){this.queryData(),this.queryColumnData()},handleRemove(t,e){this.API.site.removeSite({_id:e._id}).then(t=>{this.queryData()})},handleRemoveMany(t){let e=t.map(t=>t._id);this.API.site.removeManySite({_ids:e}).then(t=>{this.queryData()})},handleAdd(){this.show=!0,this.mode="add",this.$nextTick(()=>{this.initForm=this.LODASH.cloneDeep(this.form)})},handleDetail(t,e){this.API.site.findSiteDetail({_id:e._id},{notify:!1}).then(t=>{this.activeSite=t.data,this.currentSiteDetail=this.LODASH.get(t.data,"detail",""),this.$nextTick(()=>{this.showDetail=!0})}).catch(t=>{})},handleAddMany(){this.showImport=!0},handleEdit(t,e){this.show=!0,this.mode="edit",this.$nextTick(async()=>{let t=[],i=[],a=[];try{let o=JSON.parse(e.expand||"{}");t=o.tag||[],i=o.pin||[],a=(await this.API.site.findSiteColmunByList({siteId:e._id},{notify:!1})).data||[]}catch(t){this.$tips("error","初始化编辑数据异常","top-right",2e3)}this.form=Object.assign(this.form,e,{siteTag:t,sitePin:i,columnId:a}),this.initForm=this.LODASH.cloneDeep(this.form)})},paginationChange(){this.queryData()},async save(t){let e={...this.form},i=[],a=[],o=[],l=[];if(this.initForm.columnId.forEach(t=>{-1===e.columnId.indexOf(t)&&i.push(t)}),e.columnId.forEach((t,i)=>{if(-1===this.initForm.columnId.indexOf(t)){this.columnOptions.find(e=>e.value===t)?a.push(t):(o.push({name:t}),e.columnId.splice(i,1))}}),o.length){l=(await this.API.column.addColumn({data:o},{notify:!1})).data.map(t=>t._id)}let n=JSON.parse(e.expand);n="[object Object]"===Object.prototype.toString.call(n)?n:{},n.tag=e.siteTag,n.pin=e.sitePin,n.columnStore=e.columnId.concat(l);let s=JSON.stringify(n);e.expand=s;let d=[];if("edit"===this.mode)await this.API.site.updateSite(e),d.push(e._id);else if("add"===this.mode){delete e._id,delete e._v;let t=await this.API.site.addSite(e);d.push(t.data[0]._id)}let r=a.concat(l);r.length&&await this.API.column.bindSiteToColumn({columnIds:r,siteIds:d},{notify:!1}),i.length&&await this.API.column.unbindSiteToColumn({columnIds:i,siteIds:d},{notify:!1}),this.queryColumnData(),this.queryData()},cancel(){this.$refs.dialogForm&&this.$refs.dialogForm.close(),this.show=!1,this.initForm=null},handleCancel(){this.showDetail=!1,this.activeSite=null,this.currentSiteDetail=""},handleSaveDetail(){this.API.site.updateSite({_id:this.activeSite._id,detail:this.currentSiteDetail},{notify:!1}).then(t=>{this.$tips("success","网链详情页保存成功","top-right",1200),this.activeSite.detail=this.currentSiteDetail,this.handleCancel(),this.$nextTick(()=>{this.queryData()})})},async handleImgAddUrl(t,e){let i=new FormData;i.append("file",e);let a=await this.API.file.uploadFile(i,{url:"/file/upload?type=article"});return this.$tips("success","上传成功","top-right",1200),location.origin+location.pathname+a.data[0].path}}},h=(i("e2ee"),i("2877")),c=Object(h.a)(r,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"site-manage"},[e("TableList",{ref:"tableList",attrs:{tableData:t.tableData,tableMap:t.tableMap,formMap:t.searchFormMap,total:t.total,showAdd:!0,showAddMany:!0,showSelection:!0,showDetail:!0},on:{edit:t.handleEdit,add:t.handleAdd,detail:t.handleDetail,addMany:t.handleAddMany,remove:t.handleRemove,removeMany:t.handleRemoveMany,search:t.queryData,paginationChange:t.paginationChange,updatePagination:t.updatePagination}}),t.show?e("DialogForm",{ref:"dialogForm",attrs:{width:"520",maxHeight:"480",title:"add"==t.mode?"添加网链":"编辑网链",visible:t.show,formMap:t.formMap,formData:t.form,formRule:t.rule,"close-on-click-modal":!1,mode:t.mode,buttons:{comfirm:"确 认",cancel:"取 消"}},on:{"update:visible":function(e){t.show=e},"update:formData":function(e){t.form=e},"update:form-data":function(e){t.form=e},comfirmForm:t.save,cancelForm:t.cancel},scopedSlots:t._u([{key:"tips",fn:function(){return[e("div",{staticClass:"text text-gray-500"},[e("i",{staticClass:"el-icon-warning-outline text-orange-400"}),t._v(" 温馨提示：添加的"),e("font",{staticClass:"text-red-400"},[t._v("网链")]),t._v("需要配置关联到"),e("font",{staticClass:"text-red-400"},[t._v("栏目")]),t._v("后才会被加载显示 ")],1)]},proxy:!0}],null,!1,2415039760)}):t._e(),t.showImport?e("DialogForm",{ref:"dialogImportForm",attrs:{width:"420",height:"400",maxHeight:"400",title:"链接导入/出",visible:t.showImport,formMap:t.importFormMap,formData:t.importForm,formRule:t.importRule,mode:t.importMode,"close-on-click-modal":!1},on:{"update:visible":function(e){t.showImport=e},"update:formData":function(e){t.importForm=e},"update:form-data":function(e){t.importForm=e},siteImportSuccess:t.handleSiteImportSuccess}}):t._e(),t.showDetail?e("HsDialog",{attrs:{width:"820",maxHeight:"460",title:t.LODASH.get(t.activeSite,"name")+"详情页","close-on-click-modal":!1,visible:t.showDetail,buttons:{comfirm:"保 存"}},on:{"update:visible":function(e){t.showDetail=e},close:t.handleCancel,comfirmDialog:t.handleSaveDetail}},[e("MarkdownEditor",{attrs:{value:t.currentSiteDetail,onImgAdd:t.handleImgAddUrl},on:{"update:value":function(e){t.currentSiteDetail=e}}})],1):t._e()],1)}),[],!1,null,"0d0a12dc",null);e.default=c.exports}}]);
//# sourceMappingURL=chunk-0c9940f7.8a24d30c.js.map